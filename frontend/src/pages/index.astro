---
import Layout from '../layouts/Layout.astro';

// Fetch packages from registry (at build time)
const registryUrl = 'https://raw.githubusercontent.com/devkiraa/nex/main/registry/index.json';
let packages = [];
let error = null;

try {
  if (import.meta.env.DEV) {
    packages = [
      {
        id: 'devkiraa.pagepull',
        name: 'PagePull',
        version: '1.0.0',
        description: 'Extract web pages as clean Markdown for AI/LLM consumption',
        keywords: ['web', 'scraper', 'markdown', 'ai', 'llm']
      }
    ];
  } else {
    const response = await fetch(registryUrl);
    const data = await response.json();
    packages = data.packages || [];
  }
} catch (e) {
  error = e.message;
  packages = [];
}

const baseUrl = import.meta.env.BASE_URL;
const releaseVersion = 'v1.0.0';
const releaseBaseUrl = `https://github.com/devkiraa/nex/releases/download/${releaseVersion}`;
const releasePageUrl = `https://github.com/devkiraa/nex/releases/tag/${releaseVersion}`;
const downloadLinks = {
  windows: `${releaseBaseUrl}/nex-windows-x64.exe`,
  linux: `${releaseBaseUrl}/nex-linux-x64`,
  mac: `${releaseBaseUrl}/nex-macos-x64`,
};
---

<Layout title="Home" showSearch={false}>
  <!-- Hero Section -->
  <section class="hero">
    <div class="hero-bg"></div>
    <div class="container hero-content">
      <div class="hero-logo">nex</div>
      <h1 class="hero-title">
        Build amazing tools.
        <span class="hero-highlight">Share them with the world.</span>
      </h1>
      <p class="hero-subtitle">
        The package manager for developer tools. Install, run, and share utilities with a single command.
      </p>
      
      <div class="hero-search">
        <form action={`${baseUrl}packages`} method="get" class="hero-search-form">
          <svg class="search-icon" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <input 
            type="search" 
            name="q" 
            placeholder="Search packages..." 
            class="hero-search-input"
            autocomplete="off"
          />
          <button type="submit" class="hero-search-btn">Search</button>
        </form>
      </div>
      
      <div class="hero-stats">
        <div class="stat">
          <span class="stat-value">{packages.length}</span>
          <span class="stat-label">Packages</span>
        </div>
        <div class="stat">
          <span class="stat-value">3</span>
          <span class="stat-label">Platforms</span>
        </div>
        <div class="stat">
          <span class="stat-value">âˆž</span>
          <span class="stat-label">Possibilities</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Quick Install Section -->
  <section class="install-section">
    <div class="container">
      <div class="install-box">
        <div class="release-info">
          <div>
            <span class="release-label">Latest release</span>
            <span class="release-version">{releaseVersion}</span>
          </div>
          <a href={releasePageUrl} target="_blank" rel="noopener" class="release-link">
            View release notes
          </a>
        </div>
        <div class="install-tabs">
          <button class="tab active" data-tab="windows">Windows</button>
          <button class="tab" data-tab="linux">Linux</button>
          <button class="tab" data-tab="mac">macOS</button>
        </div>
        <div class="install-content">
          <div class="install-panel active" id="windows">
            <pre><code><span class="comment"># Download nex {releaseVersion}</span>
curl -LO {downloadLinks.windows}

<span class="comment"># Move into a folder on PATH</span>
move .\nex-windows-x64.exe %USERPROFILE%\bin\nex.exe

<span class="comment"># Verify</span>
nex --version</code></pre>
          </div>
          <div class="install-panel" id="linux">
            <pre><code><span class="comment"># Download nex {releaseVersion}</span>
curl -LO {downloadLinks.linux}
sudo install -m 755 nex-linux-x64 /usr/local/bin/nex

<span class="comment"># Verify</span>
nex --version</code></pre>
          </div>
          <div class="install-panel" id="mac">
            <pre><code><span class="comment"># Download nex {releaseVersion}</span>
curl -LO {downloadLinks.mac}
sudo install -m 755 nex-macos-x64 /usr/local/bin/nex

<span class="comment"># Verify</span>
nex --version</code></pre>
          </div>
        </div>
        <div class="install-cta">
          <a href={releasePageUrl} class="btn btn-primary" target="_blank" rel="noopener">
            Download nex {releaseVersion}
          </a>
          <a href={`${baseUrl}docs`} class="btn btn-secondary">
            Read the Docs
          </a>
        </div>
        <p class="checksum-note">Checksums and binaries are hosted on GitHub Releases. Always verify downloads before installing.</p>
      </div>
    </div>
  </section>

  <!-- Features Section -->
  <section class="features">
    <div class="container">
      <h2 class="section-title">Why nex?</h2>
      <div class="features-grid">
        <div class="feature-card">
          <div class="feature-icon">ðŸš€</div>
          <h3>Zero Dependencies</h3>
          <p>Single executable binary. No runtime required. Works on Windows, Linux, and macOS.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">ðŸ“¦</div>
          <h3>GitHub-Powered</h3>
          <p>Package registry lives on GitHub. Fork, submit PRs, and collaborate openly.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">ðŸ”§</div>
          <h3>Multi-Runtime</h3>
          <p>Run Python, Node.js, PowerShell, Bash scripts and native binaries seamlessly.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">âš¡</div>
          <h3>Lightning Fast</h3>
          <p>Written in C for maximum performance. Instant installs and execution.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">ðŸ”’</div>
          <h3>Secure</h3>
          <p>Packages are reviewed via pull requests. SHA256 checksums for downloads.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">ðŸ’š</div>
          <h3>Open Source</h3>
          <p>MIT licensed. Community-driven. Free forever.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Packages Section -->
  <section class="packages-section">
    <div class="container">
      <div class="section-header">
        <h2 class="section-title">Discover Packages</h2>
        <a href={`${baseUrl}packages`} class="view-all">View all packages â†’</a>
      </div>
      
      {error && <p class="error-msg">Failed to load packages: {error}</p>}
      
      <div class="packages-grid">
        {packages.slice(0, 6).map((pkg) => (
          <a href={`${baseUrl}packages/${pkg.id}`} class="package-card">
            <div class="package-header">
              <h3 class="package-name">{pkg.name}</h3>
              <span class="package-version">v{pkg.version}</span>
            </div>
            <p class="package-id">{pkg.id}</p>
            <p class="package-desc">{pkg.description}</p>
            <div class="package-tags">
              {pkg.keywords && pkg.keywords.slice(0, 3).map((kw: string) => (
                <span class="tag">{kw}</span>
              ))}
            </div>
          </a>
        ))}
      </div>
      
      {packages.length === 0 && !error && (
        <div class="empty-state">
          <p>No packages available yet. Be the first to <a href="https://github.com/devkiraa/nex">contribute</a>!</p>
        </div>
      )}
    </div>
  </section>

  <!-- CTA Section -->
  <section class="cta-section">
    <div class="container">
      <div class="cta-content">
        <h2>Ready to share your tools?</h2>
        <p>Publishing a package is simple. Create a manifest, submit a PR, and you're live.</p>
        <div class="cta-buttons">
          <a href={`${baseUrl}docs`} class="btn btn-primary">Get Started</a>
          <a href="https://github.com/devkiraa/nex" class="btn btn-dark">
            <svg viewBox="0 0 16 16" width="18" height="18" fill="currentColor" style="margin-right: 8px">
              <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
            </svg>
            Star on GitHub
          </a>
        </div>
      </div>
    </div>
  </section>
</Layout>

<style>
  /* Hero Section */
  .hero {
    position: relative;
    padding: 5rem 0 4rem;
    background: linear-gradient(135deg, #cb3837 0%, #a82726 100%);
    color: white;
    overflow: hidden;
  }
  
  .hero-bg {
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    opacity: 0.5;
  }
  
  .hero-content {
    position: relative;
    text-align: center;
  }

  .hero-logo {
    font-size: 5rem;
    font-weight: 700;
    letter-spacing: -3px;
    margin-bottom: 1.5rem;
    background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 50%, #e0e0e0 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: 0 4px 30px rgba(0,0,0,0.3);
    animation: logoGlow 3s ease-in-out infinite alternate;
  }

  @keyframes logoGlow {
    from {
      filter: drop-shadow(0 0 20px rgba(255,255,255,0.3));
    }
    to {
      filter: drop-shadow(0 0 40px rgba(255,255,255,0.5));
    }
  }
  
  .hero-title {
    font-size: 3rem;
    font-weight: 700;
    line-height: 1.2;
    margin-bottom: 1rem;
  }
  
  .hero-highlight {
    display: block;
    color: rgba(255,255,255,0.9);
  }
  
  .hero-subtitle {
    font-size: 1.25rem;
    opacity: 0.9;
    max-width: 600px;
    margin: 0 auto 2rem;
  }
  
  .hero-search {
    max-width: 650px;
    margin: 0 auto 2.5rem;
  }
  
  .hero-search-form {
    display: flex;
    background: white;
    border-radius: 12px;
    padding: 0.5rem;
    box-shadow: 0 8px 32px rgba(0,0,0,0.2);
  }
  
  .search-icon {
    position: absolute;
    left: 1.25rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--nex-gray);
    pointer-events: none;
  }
  
  .hero-search-form {
    position: relative;
  }
  
  .hero-search-input {
    flex: 1;
    padding: 1rem 1rem 1rem 3rem;
    border: none;
    font-size: 1.1rem;
    font-family: inherit;
    background: transparent;
    outline: none;
    color: var(--nex-black);
  }
  
  .hero-search-input::placeholder {
    color: var(--nex-gray);
  }
  
  .hero-search-btn {
    padding: 1rem 2rem;
    background: var(--nex-black);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.2s;
  }
  
  .hero-search-btn:hover {
    background: #000;
  }
  
  .hero-stats {
    display: flex;
    justify-content: center;
    gap: 4rem;
  }
  
  .stat {
    text-align: center;
  }
  
  .stat-value {
    display: block;
    font-size: 2rem;
    font-weight: 700;
  }
  
  .stat-label {
    font-size: 0.9rem;
    opacity: 0.8;
  }

  /* Install Section */
  .install-section {
    margin-top: -2rem;
    position: relative;
    z-index: 10;
    padding-bottom: 2rem;
  }
  
  .install-box {
    background: white;
    border-radius: 16px;
    box-shadow: var(--shadow-lg);
    overflow: hidden;
  }

  .release-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.25rem 1.5rem 0.5rem;
    gap: 1rem;
  }

  .release-label {
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--nex-gray);
    display: block;
  }

  .release-version {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--nex-red);
  }

  .release-link {
    font-weight: 500;
    color: var(--nex-red);
  }
  
  .install-tabs {
    display: flex;
    border-bottom: 1px solid var(--nex-border);
  }
  
  .tab {
    flex: 1;
    padding: 1rem;
    background: none;
    border: none;
    font-size: 1rem;
    font-weight: 500;
    color: var(--nex-gray);
    cursor: pointer;
    transition: all 0.2s;
    border-bottom: 3px solid transparent;
    margin-bottom: -1px;
  }
  
  .tab:hover {
    color: var(--nex-dark);
  }
  
  .tab.active {
    color: var(--nex-red);
    border-bottom-color: var(--nex-red);
  }
  
  .install-content {
    padding: 0;
  }
  
  .install-panel {
    display: none;
  }
  
  .install-panel.active {
    display: block;
  }
  
  .install-panel pre {
    margin: 0;
    border-radius: 0;
    font-size: 0.95rem;
    line-height: 1.7;
  }
  
  .install-panel .comment {
    color: #6a9955;
  }
  
  .install-cta {
    display: flex;
    gap: 1rem;
    padding: 1.5rem;
    background: var(--nex-bg);
    justify-content: center;
  }

  .checksum-note {
    text-align: center;
    font-size: 0.85rem;
    color: var(--nex-gray);
    padding: 0 1.5rem 1.5rem;
  }

  /* Features Section */
  .features {
    padding: 5rem 0;
  }
  
  .section-title {
    font-size: 2rem;
    font-weight: 700;
    text-align: center;
    margin-bottom: 3rem;
    color: var(--nex-black);
  }
  
  .features-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2rem;
  }
  
  .feature-card {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: var(--shadow-sm);
    transition: all 0.2s;
  }
  
  .feature-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-md);
  }
  
  .feature-icon {
    font-size: 2.5rem;
    margin-bottom: 1rem;
  }
  
  .feature-card h3 {
    font-size: 1.25rem;
    margin-bottom: 0.5rem;
    color: var(--nex-black);
  }
  
  .feature-card p {
    color: var(--nex-gray);
    font-size: 0.95rem;
  }

  /* Packages Section */
  .packages-section {
    padding: 4rem 0;
    background: white;
  }
  
  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
  }
  
  .section-header .section-title {
    margin-bottom: 0;
    text-align: left;
  }
  
  .view-all {
    font-weight: 500;
    color: var(--nex-red);
  }
  
  .packages-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
  }
  
  .package-card {
    display: block;
    background: var(--nex-bg);
    border: 1px solid var(--nex-border);
    border-radius: 12px;
    padding: 1.5rem;
    transition: all 0.2s;
    text-decoration: none;
  }
  
  .package-card:hover {
    border-color: var(--nex-red);
    box-shadow: var(--shadow-md);
    text-decoration: none;
  }
  
  .package-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.25rem;
  }
  
  .package-name {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--nex-black);
  }
  
  .package-version {
    font-size: 0.85rem;
    color: var(--nex-success);
    font-weight: 500;
  }
  
  .package-id {
    font-size: 0.85rem;
    color: var(--nex-gray);
    font-family: var(--font-mono);
    margin-bottom: 0.75rem;
  }
  
  .package-desc {
    font-size: 0.95rem;
    color: var(--nex-dark);
    margin-bottom: 1rem;
    line-height: 1.5;
  }
  
  .package-tags {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }
  
  .tag {
    background: white;
    border: 1px solid var(--nex-border);
    padding: 0.25rem 0.75rem;
    border-radius: 100px;
    font-size: 0.8rem;
    color: var(--nex-gray);
  }
  
  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--nex-gray);
  }
  
  .error-msg {
    background: #ffeaea;
    color: var(--nex-red);
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1rem;
  }

  /* CTA Section */
  .cta-section {
    padding: 5rem 0;
    background: linear-gradient(135deg, var(--nex-black) 0%, #333 100%);
    color: white;
  }
  
  .cta-content {
    text-align: center;
    max-width: 600px;
    margin: 0 auto;
  }
  
  .cta-content h2 {
    font-size: 2rem;
    margin-bottom: 1rem;
  }
  
  .cta-content p {
    opacity: 0.8;
    margin-bottom: 2rem;
  }
  
  .cta-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
  }
  
  .cta-buttons .btn-dark {
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
  }
  
  .cta-buttons .btn-dark:hover {
    background: rgba(255,255,255,0.2);
  }

  /* Responsive */
  @media (max-width: 968px) {
    .features-grid,
    .packages-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  
  @media (max-width: 640px) {
    .hero-logo {
      font-size: 3.5rem;
    }

    .hero-title {
      font-size: 2rem;
    }
    
    .hero-stats {
      gap: 2rem;
    }
    
    .features-grid,
    .packages-grid {
      grid-template-columns: 1fr;
    }
    
    .cta-buttons {
      flex-direction: column;
    }
    
    .section-header {
      flex-direction: column;
      gap: 1rem;
      text-align: center;
    }
  }
</style>

<script>
  // Tab switching
  document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
      const target = tab.getAttribute('data-tab');
      
      // Update tabs
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      
      // Update panels
      document.querySelectorAll('.install-panel').forEach(p => p.classList.remove('active'));
      document.getElementById(target)?.classList.add('active');
    });
  });
</script>
